(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{192:function(e,t,s){e.exports=s.p+"assets/img/cd-pipeline.79fa1089.svg"},232:function(e,t,s){"use strict";s.r(t);var i=[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"publish-deploy-your-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#publish-deploy-your-app","aria-hidden":"true"}},[this._v("#")]),this._v(" Publish/Deploy your app")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"deployment-pipeline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deployment-pipeline","aria-hidden":"true"}},[this._v("#")]),this._v(" Deployment pipeline")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:s(192),alt:"Deployment pipeline"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[this._v("#")]),this._v(" Prerequisites")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"install-change-log-generator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-change-log-generator","aria-hidden":"true"}},[this._v("#")]),this._v(" Install Change log generator")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"configure-application-and-third-party-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configure-application-and-third-party-services","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure application and third-party services")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("retrieve the "),s("code",[e._v("google-services.json")]),e._v(" to be stored as a secret file in the "),s("em",[e._v("cordova")]),e._v(" directory")]),e._v(" "),s("li",[e._v("create an Android app in your Firebase app and keep track of secret server key in "),s("em",[e._v("Parameters > Cloud Messaging")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("keep track of app ARN")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Activate the Google+ API on your project")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("the redirect URL should match "),t("em",[this._v("your.domain/auth/google/callback")])]),this._v(" "),t("li",[this._v("download the "),t("em",[this._v("json")]),this._v(" dans keep track of client ID and secret")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("the redirect URL should match "),t("em",[this._v("your.domain/auth/github/callback")])]),this._v(" "),t("li",[this._v("download the "),t("em",[this._v("json")]),this._v(" dans keep track of client ID and secret")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("keep track of access key ID and secret")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[this._v("Create a bucket for your app in the Kalisio account\n"),t("ul",[t("li",[this._v("keep track of its name")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("keep track of access key ID and secret")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),t("p",[this._v("Note: some of the previous accounts/IDs are not app specific and can be share accross multiple apps, e.g. S3, SNS, etc.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("export APP_SECRET=xxx\nexport GOOGLE_MAIL_USER=xxx\nexport GOOGLE_MAIL_PASSWORD=xxx\nexport SNS_ACCESS_KEY=xxx\nexport SNS_SECRET_ACCESS_KEY=xxx\nexport SNS_ANDROID_ARN=xxx\nexport S3_ACCESS_KEY=xxx\nexport S3_SECRET_ACCESS_KEY=xxx\nexport S3_BUCKET=xxx\nexport GITHUB_CLIENT_ID=xxx\nexport GITHUB_CLIENT_SECRET=xxx\nexport GOOGLE_CLIENT_ID=xxx\nexport GOOGLE_CLIENT_SECRET=xxx\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("github: {\n  clientID: process.env.GITHUB_CLIENT_ID,\n  clientSecret: process.env.GITHUB_CLIENT_SECRET\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"danger custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("You should never store production passwords or other sensitive production data in a clear form in source code or config files.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("You shouldn't use production secrets in development and test mode.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"configure-ci-cd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configure-ci-cd","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure CI/CD")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("To set up the CI/CD pipeline, sensitive data are needed to access the required services (SSH, third-party, etc.) and "),t("strong",[this._v("should not be pushed under source control unless you use private repositories or encryption")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"secret-variables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secret-variables","aria-hidden":"true"}},[this._v("#")]),this._v(" Secret variables")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("If you'd like to set a value holding multilines or special characters take care to surround it with "),t("code",[this._v('"')]),this._v(" so that it will be properly escaped.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"secret-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secret-file","aria-hidden":"true"}},[this._v("#")]),this._v(" Secret file")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[e._v("File")]),e._v(" "),s("th",{staticStyle:{"text-align":"left"}},[e._v("Description")])])]),e._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("keystore file")]),e._v(" "),s("td",{staticStyle:{"text-align":"left"}},[e._v("A binary file containing the private key of the certificate you need to sign the Android app")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("cordova build file")]),e._v(" "),s("td",{staticStyle:{"text-align":"left"}},[e._v("A Json file used by Cordova to sign the generated application. It uses the keystore file")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("google play service account")]),e._v(" "),s("td",{staticStyle:{"text-align":"left"}},[e._v("A Json file storing the data needed to use the Google Play service account")])]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("google services account")]),e._v(" "),s("td",{staticStyle:{"text-align":"left"}},[e._v("A Json file storing the the keys to access the various Google services")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("tar cvf secrets.tar your_keystore.keystore build.json google-play.json google-services.json\ntravis encrypt-file secrets.tar\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"plugins-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugins-modules","aria-hidden":"true"}},[this._v("#")]),this._v(" Plugins/Modules")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("increase the package version number in the "),s("strong",[e._v("package.json")]),e._v(" file (frontend and backend API)")]),e._v(" "),s("li",[e._v("publish the module on the NPM registry")]),e._v(" "),s("li",[e._v("create a tag accordingly in the git repository and push it")]),e._v(" "),s("li",[e._v("generates the changelog in the git repository and push it")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("Modules are published under the "),s("code",[e._v("@kalisio")]),e._v(" namespace with a "),s("code",[e._v("kdk")]),e._v(" prefix in NPM, e.g. "),s("code",[e._v("kCore")]),e._v(" NPM package is named "),s("code",[e._v("@kalisio/kdk-core")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("This requires you to have a NPM and GitHub account and be a team member of the Kalisio organization, if you'd like to become a maintainer please tell us")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Depending on the release type the following command will do the job (where type is either "),t("code",[this._v("patch")]),this._v(", "),t("code",[this._v("minor")]),this._v(", "),t("code",[this._v("major")]),this._v("):")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("yarn/npm run release:type\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("Before you publish a plugin take care of updating the version of your dependent plugins to the latest version published, for example  perform "),t("code",[this._v("yarn upgrade kCore")]),this._v(" for a plugin depending on the core plugin before publishing it**")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"web-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-app","aria-hidden":"true"}},[this._v("#")]),this._v(" Web app")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("increase the package version number in the "),t("strong",[this._v("package.json")]),this._v(" file (frontend and backend API)")]),this._v(" "),t("li",[this._v("create a tag accordingly in the git repository and push it")]),this._v(" "),t("li",[this._v("generates the changelog in the git repository and push it")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("Before you publish your app take care of updating the version of all dependent plugins to the latest version published, for example  perform "),t("code",[this._v("yarn upgrade kCore kTeam")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Depending on the release type the following command will do the job (where type is either "),t("code",[this._v("patch")]),this._v(", "),t("code",[this._v("minor")]),this._v(", "),t("code",[this._v("major")]),this._v("):")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("yarn/npm run release:type\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("Depending on the app the push of tags or changlog is more or less automated in order to have more control so that youd could have more scripts to run in order to complete the publication")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("docker build -t kalisio/kapp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[this._v(".")]),this._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("docker login\ndocker push kalisio/kapp\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("And tag it ("),t("code",[this._v("version_tag")]),this._v(" being the current version number like "),t("code",[this._v("1.1.2")]),this._v(")")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("docker tag kalisio/kapp kalisio/kapp:version_tag\ndocker push kalisio/kapp:version_tag\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("This requires you to have a DockerHub account and be a team member of the Kalisio organization, if you'd like to become a maintainer please tell us")])])}],r=s(0),a=Object(r.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),e._m(1),e._v(" "),s("p",[e._v("The global continuous integration and deployment (CI/CD) pipeline is illustrated in the following schema:")]),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),s("p",[e._v("In order to be able to generate the changelog for your published app/modules you need this "),s("a",{attrs:{href:"https://github.com/skywinder/github-changelog-generator",target:"_blank",rel:"noopener noreferrer"}},[e._v("gem"),s("OutboundLink")],1),e._v(", which creates a log file based on "),s("strong",[e._v("tags")]),e._v(", "),s("strong",[e._v("issues")]),e._v(" and merged "),s("strong",[e._v("pull requests")]),e._v(" (and splits them into separate lists according to labels) from :octocat: GitHub Issue Tracker. This requires you to install (e.g. for Windows) "),s("a",{attrs:{href:"http://rubyinstaller.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ruby"),s("OutboundLink")],1),e._v(" and its "),s("a",{attrs:{href:"https://github.com/oneclick/rubyinstaller/wiki/Development-Kit",target:"_blank",rel:"noopener noreferrer"}},[e._v("DevKit"),s("OutboundLink")],1),e._v(".")]),e._v(" "),e._m(5),e._v(" "),s("p",[e._v("As an application often relies on third-party services its configuration must include secrets like API keys, passwords, etc. In this section we detail how we manage it in a secure way.")]),e._v(" "),s("p",[e._v("Depending on the services you need you will have to do the following:")]),e._v(" "),s("ul",[s("li",[e._v("Generate a secret to secure your authentication, use one generated by the Feathers CLI")]),e._v(" "),s("li",[e._v("Create a Firebase app in the "),s("a",{attrs:{href:"https://console.firebase.google.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Firebase Console"),s("OutboundLink")],1),e._v(" "),e._m(6)]),e._v(" "),s("li",[e._v("Create a GCM application in the "),s("a",{attrs:{href:"https://eu-west-1.console.aws.amazon.com/sns/v2/home",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS SNS console"),s("OutboundLink")],1),e._v(" using the previous server key\n"),e._m(7)]),e._v(" "),s("li",[e._v("Create a new project for your app in the "),s("a",{attrs:{href:"https://console.cloud.google.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Cloud Console"),s("OutboundLink")],1),e._v(" "),e._m(8)]),e._v(" "),s("li",[e._v("Create an OAuth2 ID for a Web App in "),s("a",{attrs:{href:"https://console.cloud.google.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Cloud Console"),s("OutboundLink")],1),e._v(" > "),s("em",[e._v("API & services")]),e._v(" "),e._m(9)]),e._v(" "),s("li",[e._v("Create an OAuth2 App in "),s("a",{attrs:{href:"https://github.com/organizations/kalisio/settings/applications",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub"),s("OutboundLink")],1),e._v(" "),e._m(10)]),e._v(" "),s("li",[e._v("Create an AWS user in "),s("a",{attrs:{href:"https://console.aws.amazon.com/iam/home",target:"_blank",rel:"noopener noreferrer"}},[e._v("IAM"),s("OutboundLink")],1),e._v(" with access to S3 API (e.g. "),s("em",[e._v("AmazonS3FullAccess")]),e._v(")\n"),e._m(11)]),e._v(" "),e._m(12),e._v(" "),s("li",[e._v("Create an AWS user in "),s("a",{attrs:{href:"https://console.aws.amazon.com/iam/home",target:"_blank",rel:"noopener noreferrer"}},[e._v("IAM"),s("OutboundLink")],1),e._v(" with access to SNS API (e.g. "),s("em",[e._v("AmazonSNSFullAccess")]),e._v(")\n"),e._m(13)])]),e._v(" "),e._m(14),e._v(" "),s("p",[e._v("Create required environment variables in a script file you can source before launching your app:")]),e._v(" "),e._m(15),s("p",[e._v("Then, retrieve this variables in config files like this:")]),e._v(" "),e._m(16),s("p",[e._v("In your local development environment you should use the script to setup all the required secrets. This script should be safe-guarded in a non-public environment.")]),e._v(" "),e._m(17),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),s("p",[e._v("We heavily rely on "),s("a",{attrs:{href:"https://travis-ci.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Travis CI"),s("OutboundLink")],1),e._v(" for continuous integration and delivery, as such you need to create the CI/CD pipeline in Travis CI by syncing your GitHub repository.")]),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),s("p",[e._v("If some of the sensitive data are stored using environment variables, you have to use "),s("a",{attrs:{href:"https://docs.travis-ci.com/user/environment-variables/",target:"_blank",rel:"noopener noreferrer"}},[e._v("encrypted environment variables"),s("OutboundLink")],1),e._v(" set either in build file or repository settings.")]),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),s("p",[e._v("If you need additional sensitive data stored through "),s("a",{attrs:{href:"https://docs.travis-ci.com/user/encrypting-files/",target:"_blank",rel:"noopener noreferrer"}},[e._v("files"),s("OutboundLink")],1),e._v(" create a "),s("em",[e._v("secrets.tar")]),e._v(" containing all secured files and encode it to "),s("em",[e._v("secrets.tar.enc")]),e._v(" a using "),s("router-link",{attrs:{to:"./../../tools/cli.html#travis-cli"}},[e._v("Travis CLI")]),e._v(". This file will be decrypted before the build or whenever you need something inside.")],1),e._v(" "),s("p",[e._v("Indeed, as mentioned in the "),s("a",{attrs:{href:"https://docs.travis-ci.com/user/encrypting-files/#Encrypting-multiple-files",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation"),s("OutboundLink")],1),e._v(", it is not possible to encrypt multiple files and thus requires to create a "),s("code",[e._v("tar")]),e._v(" file containing the different secret files and encrypts the archive.")]),e._v(" "),s("p",[e._v("The table below lists for example the required files to publish a mobile app using Cordova:")]),e._v(" "),e._m(24),e._v(" "),s("p",[e._v("You need to be logged into Travis CI before generating the secret file like this:")]),e._v(" "),e._m(25),e._m(26),e._v(" "),s("p",[e._v("The same process applies when releasing a patch, minor or major version, i.e. the following tasks are done:")]),e._v(" "),e._m(27),e._v(" "),e._m(28),e._v(" "),e._m(29),e._v(" "),e._m(30),e._v(" "),e._m(31),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("If you have a lot of issues/PRs to be integrated in change log please "),s("a",{attrs:{href:"https://github.com/github-changelog-generator/github-changelog-generator#github-token",target:"_blank",rel:"noopener noreferrer"}},[e._v("generate a GitHub token"),s("OutboundLink")],1),e._v(" to avoid rate-limiting on their API and set the "),s("code",[e._v("CHANGELOG_GITHUB_TOKEN")]),e._v(" environment variable to your token before publishing**")])]),e._v(" "),s("div",{staticClass:"danger custom-block"},[s("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),s("p",[e._v("The changelog suffers from the following "),s("a",{attrs:{href:"https://github.com/github-changelog-generator/github-changelog-generator/issues/497",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue"),s("OutboundLink")],1),e._v(" so you might have to edit the generated changelog when pushing on different branches**")])]),e._v(" "),e._m(32),e._v(" "),e._m(33),e._v(" "),s("p",[e._v("Almost the same process applies as for the plugins/modules except the app is not published on the NPM registry, i.e. the following tasks are to be done:")]),e._v(" "),e._m(34),e._v(" "),e._m(35),e._v(" "),e._m(36),e._v(" "),e._m(37),e._m(38),e._v(" "),s("p",[e._v("Because Kalisio web app are also released as Docker images you can build it like this:")]),e._v(" "),e._m(39),s("p",[e._v("Then release it as latest version:")]),e._v(" "),e._m(40),e._m(41),e._v(" "),e._m(42),e._m(43)])},i,!1,null,null,null);a.options.__file="deploy.md";t.default=a.exports}}]);