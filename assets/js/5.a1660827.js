(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{226:function(t,e,a){t.exports=a.p+"assets/img/catalog-data-model.998b319c.png"},227:function(t,e,a){t.exports=a.p+"assets/img/feature-data-model.de64ed49.png"},228:function(t,e,a){t.exports=a.p+"assets/img/aggregated-feature-data-model.688823b1.png"},229:function(t,e,a){t.exports=a.p+"assets/img/feature-hooks.c545f93a.png"},272:function(t,e,a){"use strict";a.r(e);var s=a(2),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#services"}},[t._v("#")]),t._v(" Services")]),t._v(" "),s("h2",{attrs:{id:"geocoder-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#geocoder-service"}},[t._v("#")]),t._v(" Geocoder service")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Available as a global service")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[s("code",[t._v("create")]),t._v(" method is the only one allowed from the client/server side")])]),t._v(" "),s("p",[t._v("Rely on "),s("a",{attrs:{href:"https://github.com/nchaulet/node-geocoder",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-geocoder"),s("OutboundLink")],1),t._v(" under-the-hood.")]),t._v(" "),s("h3",{attrs:{id:"data-model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model"}},[t._v("#")]),t._v(" Data model")]),t._v(" "),s("p",[t._v("The data model of a geocoding request as used by the API only contains the "),s("strong",[t._v("address")]),t._v(" field specifying the string to be looked for. The request response depends on the geocoding provider although there is a set of common properties, see example below.")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" service "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'geocoder'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'29 champs elysÃ©e paris'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresults"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("element")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" latitude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" longitude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \t\tstreetNumber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" streetName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zipcode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" element\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[t._v("#")]),t._v(" Hooks")]),t._v(" "),s("p",[t._v("No "),s("RouterLink",{attrs:{to:"/api/kmap/hooks.html"}},[t._v("hooks")]),t._v(" are executed on the "),s("code",[t._v("geocoder")]),t._v(" service for now.")],1),t._v(" "),s("h2",{attrs:{id:"catalog-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#catalog-service"}},[t._v("#")]),t._v(" Catalog service")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Available as a global and a contextual service")])]),t._v(" "),s("p",[t._v("The service can be created using the global "),s("strong",[t._v("createCatalogService(context, db)")]),t._v(" function, if no arguments provided it will be available as a global service otherwise as a contextual service (e.g. attached to a specific organization), please also refer to core module "),s("RouterLink",{attrs:{to:"/api/kcore/application.html#createservice-name-options"}},[s("strong",[t._v("createService()")])]),t._v(".")],1),t._v(" "),s("p",[t._v("Here is a sample code to retrieve all data layer descriptors available in the catalog:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" catalogService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'catalog'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" catalogService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("layer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Process i18n if you'd like to")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$t")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$t")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$t")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$t")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("description"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create the underlying layer object in the map/globe")]),t._v("\n\t  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addLayer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"data-model-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-2"}},[t._v("#")]),t._v(" Data model")]),t._v(" "),s("p",[t._v("The data model of a layer descriptor as used by the API is detailed below.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(226),alt:"Catalog data model"}})]),t._v(" "),s("p",[t._v("The catalog is typically populated at application startup with a default set of layers, as a consequence the best is to have a look at some of our application configuration files like the one of "),s("a",{attrs:{href:"https://github.com/kalisio/kano/blob/master/api/config/layers.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kano"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("The details of each property are the following:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("name")]),t._v(" : the layer name, typically used in the "),s("RouterLink",{attrs:{to:"/api/kmap/components.html#layers-panel"}},[t._v("layers panel")])],1),t._v(" "),s("li",[s("strong",[t._v("description")]),t._v(" : the layer short description, typically used in the "),s("RouterLink",{attrs:{to:"/api/kmap/components.html#layers-panel"}},[t._v("layers panel")])],1),t._v(" "),s("li",[s("strong",[t._v("type")]),t._v(" : usually "),s("code",[t._v("BaseLayer")]),t._v(" for map backgrounds, "),s("code",[t._v("TerrainLayer")]),t._v(" for 3D terrain, "),s("code",[t._v("OverlayLayer")]),t._v(" for additionnal data layers")]),t._v(" "),s("li",[s("strong",[t._v("tags")]),t._v(" : list of tags to classify the layer")]),t._v(" "),s("li",[s("strong",[t._v("icon")]),t._v(" : a "),s("a",{attrs:{href:"https://quasar.dev/options/app-icons",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quasar icon"),s("OutboundLink")],1),t._v(" for the layer, typically used in the "),s("RouterLink",{attrs:{to:"/api/kmap/components.html#layers-panel"}},[t._v("layers panel")])],1),t._v(" "),s("li",[s("strong",[t._v("iconUrl")]),t._v(" : a link to an image to be used as icon for the layer, typically used in the "),s("RouterLink",{attrs:{to:"/api/kmap/components.html#layers-panel"}},[t._v("layers panel")])],1),t._v(" "),s("li",[s("strong",[t._v("attribution")]),t._v(" : data attribution informaiton to be displayed along with the layer")]),t._v(" "),s("li",[s("strong",[t._v("leaflet")]),t._v(" : options to be passed to the underlying Leaflet layer constructor\n"),s("ul",[s("li",[s("strong",[t._v("type")]),t._v(": the type of Leaflet layer to be constructed (i.e. class/constructor function name), e.g. "),s("code",[t._v("tileLayer")]),t._v(" or "),s("code",[t._v("geoJson")])]),t._v(" "),s("li",[s("strong",[t._v("source")]),t._v(": if provided this property is reserved for the first argument to be passed to the underlying Leaflet layer constructor, typically the URL or the GeoJson data, in this case the options will be passed as the second argument")])])]),t._v(" "),s("li",[s("strong",[t._v("cesium")]),t._v(": options to be passed to the underlying Cesium layer constructor\n"),s("ul",[s("li",[s("strong",[t._v("type")]),t._v(": the type of Cesium layer to be constructed (i.e. class/constructor function name), e.g. "),s("code",[t._v("EllipsoidTerrainProvider")]),t._v(" or "),s("code",[t._v("BingImageryProvider")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("type")]),t._v(" and "),s("code",[t._v("tags")]),t._v(" attributes are typically used by the "),s("RouterLink",{attrs:{to:"/api/kmap/components.html#layers-panel"}},[t._v("layers panel")]),t._v(" to organize the layer selection in a meaningful way.")],1)]),t._v(" "),s("p",[t._v("If the layer is a feature layer based on a "),s("RouterLink",{attrs:{to:"/api/kmap/services.html#feature-service"}},[t._v("feature service")]),t._v(" the additional properties are the following:")],1),t._v(" "),s("ul",[s("li",[s("strong",[t._v("service")]),t._v(": the name of the underlying feature service,")]),t._v(" "),s("li",[s("strong",[t._v("probeService")]),t._v(": the name of the underlying feature service containing probe locations,")]),t._v(" "),s("li",[s("strong",[t._v("featureId")]),t._v(": the name of the unique feature identifier in feature (relative to the nested "),s("code",[t._v("properties")]),t._v(" object),")]),t._v(" "),s("li",[s("strong",[t._v("history")]),t._v(": the expiration period for stored feature")]),t._v(" "),s("li",[s("strong",[t._v("variables")]),t._v(": array of available properties in feature to be "),s("RouterLink",{attrs:{to:"/api/kmap/services.html#time-based-feature-aggregation"}},[t._v("aggregated over time")]),t._v(", for each entry the following options are available:\n"),s("ul",[s("li",[s("strong",[t._v("name")]),t._v(": property name in feature (relative to the nested "),s("code",[t._v("properties")]),t._v(" object),")]),t._v(" "),s("li",[s("strong",[t._v("label")]),t._v(": property label to use in UI,")]),t._v(" "),s("li",[s("strong",[t._v("units")]),t._v(": array of target units to be available in the legend, the first unit is the one used to store the data, others will be converted from using "),s("a",{attrs:{href:"http://mathjs.org/docs/datatypes/units.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("math.js"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("strong",[t._v("chartjs")]),t._v(": options to be passed to "),s("a",{attrs:{href:"https://www.chartjs.org/docs/latest/charts/line.html#dataset-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("chart.js"),s("OutboundLink")],1),t._v(" when drawing timeseries")])])],1)]),t._v(" "),s("h3",{attrs:{id:"hooks-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-2"}},[t._v("#")]),t._v(" Hooks")]),t._v(" "),s("p",[t._v("The sole "),s("RouterLink",{attrs:{to:"/api/kmap/hooks.html"}},[t._v("hook")]),t._v(" executed on the "),s("code",[t._v("catalog")]),t._v(" service is one that sets the default query type to layer (ie "),s("code",[t._v("$ne: 'service'")]),t._v(") when not provided.")],1),t._v(" "),s("h2",{attrs:{id:"feature-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#feature-service"}},[t._v("#")]),t._v(" Feature service")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("Available as a global and a contextual service")])]),t._v(" "),s("p",[t._v("The service can be created using the global "),s("strong",[t._v("createCatalogService(options)")]),t._v(" function, if no context provided it will be available as a global service otherwise as a contextual service (e.g. attached to a specific organization), please also refer to core module "),s("RouterLink",{attrs:{to:"/api/kcore/application.html#createservice-name-options"}},[s("strong",[t._v("createService()")])]),t._v(".")],1),t._v(" "),s("h3",{attrs:{id:"data-model-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-model-3"}},[t._v("#")]),t._v(" Data model")]),t._v(" "),s("p",[t._v("The common model is a "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc7946#section-3.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("GeoJSON feature"),s("OutboundLink")],1),t._v(" with "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc7946#section-3.1.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("GeoJSON point geometry"),s("OutboundLink")],1),t._v(". However, it also supports time-stamped features to manage the temporal evolution of either the geometry (e.g. a moving aircraft) or the attributes/properties (e.g. a probe). As a consequence it also usually contains the following:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("time")]),t._v(' : the date/time of the "measure" that produced the feature')])]),t._v(" "),s("p",[t._v("The raw data model of a feature (ie when no aggregation is performed) as used by the API is detailed below.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(227),alt:"Feature data model"}})]),t._v(" "),s("h3",{attrs:{id:"time-based-feature-aggregation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#time-based-feature-aggregation"}},[t._v("#")]),t._v(" Time-based feature aggregation")]),t._v(" "),s("p",[t._v("Sometimes it is useful to retrieve a single result aggregating all the times for a given feature instead of multiple single results (i.e. one per time). You can perform such an aggregation based on "),s("a",{attrs:{href:"https://docs.mongodb.com/manual/core/aggregation-pipeline/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB capabilities"),s("OutboundLink")],1),t._v(" like this:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'features'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  query"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    time"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Target time range")]),t._v("\n      $gte"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2017-05-24T12:00:00.000Z'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      $lte"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2017-05-25T12:00:00.000Z'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    $groupBy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'properties.iata_code'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Will perform aggregation based on this unique feature identifier")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'properties.iata_code'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'LFBO'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The target feature to aggregate, if omitted all will be or you can provide a list with $in")]),t._v("\n    $aggregate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'geometry'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'speed'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// List of properties to aggregate over time")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something with the aggregated feature")]),t._v("\n")])])]),s("p",[t._v("When performing aggregation, "),s("strong",[t._v("time")]),t._v(" will become an object containing a key per aggregated element according to its name (e.g. "),s("code",[t._v("geometry")]),t._v(", "),s("code",[t._v("speed")]),t._v("). The value of each key will be the ordered list of available times for the element (unless you specified a different "),s("code",[t._v("$sort")]),t._v(" order). The value of each aggregated element property (e.g. "),s("code",[t._v("properties.speed")]),t._v(") will become an array of values ordered according to ascending time (replacing the scalar property of the raw feature).")]),t._v(" "),s("p",[t._v("The data model of a feature as returned by the API when some elements of the feature are aggregated over time is detailed below.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(228),alt:"Aggregated feature data model"}})]),t._v(" "),s("h3",{attrs:{id:"advanced-feature-filtering"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#advanced-feature-filtering"}},[t._v("#")]),t._v(" Advanced feature filtering")]),t._v(" "),s("p",[t._v("Features are spatially indexed based on "),s("a",{attrs:{href:"https://docs.mongodb.com/manual/applications/geospatial-indexes/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB capabilities"),s("OutboundLink")],1),t._v(". So you can perform a "),s("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/operator/query-geospatial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("geospatial query"),s("OutboundLink")],1),t._v(" on your results like this:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" api "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/api'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" collection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'features'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  query"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    geometry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      $near"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        $geometry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Point'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          coordinates"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("longitude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" latitude"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        $maxDistance"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// in meters, i.e. 10 Kms around")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something with the resulting feature collection")]),t._v("\n")])])]),s("p",[t._v("Such a complex query is fine when using the "),s("a",{attrs:{href:"https://docs.feathersjs.com/api/client.html#universal-isomorphic-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("Feathers isomorphic API"),s("OutboundLink")],1),t._v(" but if to be expressed manually as REST you have to convert nested objects to array notation like this: "),s("code",[t._v("/api/features?probeId=59248de38bb91d28d8155b3c&forecastTime=2017-05-27T07:00:00.000Z&geometry[$near][$maxDistance]=1000000&geometry[$near][$geometry][type]=Point&geometry[$near][$geometry][coordinates][]=5&geometry[$near][$geometry][coordinates][]=43")]),t._v(".")]),t._v(" "),s("p",[t._v("You can also filter results according to the computed element values by using the "),s("a",{attrs:{href:"https://docs.feathersjs.com/api/databases/querying.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Feathers common database query API"),s("OutboundLink")],1),t._v(", e.g. to get results with a speed between 2 m/s and 5 m/s:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" api "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/api'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" collection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'features'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  query"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'properties.speed'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      $gte"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      $lte"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something with the resulting feature collection")]),t._v("\n")])])]),s("h3",{attrs:{id:"hooks-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks-3"}},[t._v("#")]),t._v(" Hooks")]),t._v(" "),s("p",[t._v("The following "),s("RouterLink",{attrs:{to:"/api/kmap/hooks.html"}},[t._v("hooks")]),t._v(" are executed on the "),s("code",[t._v("feature")]),t._v(" service:\n"),s("img",{attrs:{src:a(229),alt:"Features hooks"}})],1)])}),[],!1,null,null,null);e.default=r.exports}}]);