# Infrastructure

## Docker

Remove untaged/intermediate images generated by builds:
```
docker rmi $(docker images | grep "<none>" | awk '{print $3}')
```
Follow-up logs while running a container:
```
docker logs container_name -f --tail 100
```
Find the location of the log file of a container:
```
docker inspect --format='{{.LogPath}}' container_name
```
Find the location of a named volume of a container:
```
docker volume inspect volume_name
```
Export the logs with errors in a file:
```
docker logs aktnmap > aktnmap.log 2>&1
```
Quick container fix:
```
// Perform configuration changes inside the container then exit
docker exec -it container_name bash
// Or copy configuration files to host then back to container
docker cp container_name:/conf/config_file .
// Edit config file
docker cp config_file container_name:/conf
docker commit container_name repository:tag
docker-compose down ...
docker-compose up ...
```
Check why a swarm service did not start (empty logs, no replica):
```
docker service ps --no-trunc {serviceName}
```

## Scaleway

A [step-by-step configuration](https://gist.github.com/cnouguier/a1ecc88f67819a610ae8e4d221789a8c) of a new server with Docker and a single logical volume.

# Networking

List all running ssh sessions: `netstat -tnpa | grep 'ESTABLISHED.*sshd'`

List all ssh session attempts: `cat /var/log/auth.log`
